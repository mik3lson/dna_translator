<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Translation Result</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/result.css') }}">
</head>
<body>
    <!-- HEADER-->
    <div class="header">
        <div class="header-left">
            <img 
               src="{{ url_for('static', filename='img/side_bar-removebg-preview.png') }}"
                 class="side-bar-icon">
        </div>

        <a href="/" class="get-started-btn">New Translation</a>
    </div>

    <div class ="result-container">

        <h1>DNA Translation Result</h1>
        <div class="result-row">
            <div class="label">DNA Input:</div>
            <div class="value-box">
                {{ dna_sequence[:30] }}{% if dna_sequence|length > 30 %}...{% endif %}
            </div>
        </div>
    
        <div class="result-viewer">

            <!--DROPDOWN-->

            <div class="selector">
                <select id="resultSelect" onchange="updateResult()">
                    <option value ="protein">Protein</option>
                    <option value="rna">RNA</option>
                    <option value ="protString">Protein String</option>
                </select>
            </div>

            <!--RESULT BOX-->
            <div class="result-box">
                <pre id = "resultContent" class="sequence">{{ result }}</pre>
            </div>
        </div>
        <div class="blast-result-box" id="blastResultBox" style="display: none;">
            <h2>BLAST Results</h2>
            <div id="blastResultContent"></div>
        </div>
        
        <div class="blast">
            <button class="get-started-btn" onclick="openModal()">Blast</button>
        </div>

        
<a style="color:aliceblue" href="/">Back</a>

    </div>
    <div class="modal-bg">
        <div class="modal-box">
            <p>Running BLAST…</p>
            <p>NCBI might take 1–2 minutes ⏳</p>
        </div>
    </div>
    <script>
        const results = {
        rna: `{{ rna_sequence }}`,
        protein: `{{ result }}`,
        protString: `{{ protString }}`
    };

    function updateResult() {
        const selected = document.getElementById("resultSelect").value;
        document.getElementById("resultContent").textContent = results[selected];
    }

    async function openModal() {
        console.log("Blast button has been clicked")
        
        const modal = document.querySelector(".modal-bg");
        modal.classList.add("show");

        await new Promise(resolve => setTimeout(resolve, 50));

        document.getElementById("blastResultBox").style.display = "none";
        document.getElementById("blastResultContent").innerHTML = "";

        try {
            const response = await fetch('/blast');
            const data = await response.json();

            closeModal();
            displayBlastResults(data);
        } catch (error) {
            console.error('Error:', error);
            closeModal();
            alert('Error running BLAST');
        }
    
    }
    function closeModal() {
        document.querySelector(".modal-bg").classList.remove("show");
    }

    function displayBlastResults(data) {
        const blastBox = document.getElementById("blastResultBox");
        const blastContent = document.getElementById("blastResultContent");
        
        if (data.status === "error") {
            blastBox.style.display = "block";
            blastContent.innerHTML = `<p style="color:red;">${data.message}</p>`;
            return;
        }

        blastContent.innerHTML = `
            <p><strong>Title:</strong> ${data.title}</p>
            <p><strong>Accession:</strong> ${data.accession}</p>
            <p><strong>E-value:</strong> ${data.evalue}</p>
        `;

    blastBox.style.display = "block";
}
    </script>
    



</body>
</html>
